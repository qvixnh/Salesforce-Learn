<!-- LWC_SearchStudent.html -->
<template>
    <lightning-card title="Student List" icon-name="standard:education">
        <div class="slds-m-around_medium">
            <lightning-combobox
                label="Select Class"
                value={selectedClass}
                options={classes}
                onchange={handleClassChange}>
            </lightning-combobox>
            <lightning-input label="Student Code" value={searchCode} onchange={handleSearchCodeChange}></lightning-input>
            <lightning-input label="Student Name" value={searchName} onchange={handleSearchNameChange}></lightning-input>
            <lightning-input type="date" label="Birthdate" value={birthdate} onchange={handleBirthdateChange} date-style="short"></lightning-input>
            <lightning-combobox
                label="Day of Birth"
                value={dayOfBirth}
                options={dayOptions}
                onchange={handleDayOfBirthChange}>
            </lightning-combobox>

            <lightning-combobox
                label="Month of Birth"
                value={monthOfBirth}
                options={monthOptions}
                onchange={handleMonthOfBirthChange}>
            </lightning-combobox>
            <lightning-input type="number" label="Year of Birth" min="1900" max="2100" value={yearOfBirth} onchange={handleYearOfBirthChange}></lightning-input>

            <lightning-button label="Search" onclick={handleSearch}></lightning-button>
            <lightning-button label="Clear Search Filters" onclick={handleClearFilters}></lightning-button>
            <!-- Modal for displaying student details -->
            <template if:true={showModal}>
                <div class="slds-modal slds-fade-in-open">
                    <div class="slds-modal__container">
                        <header class="slds-modal__header">
                            <h2 class="slds-text-heading_medium">Student Details</h2>
                        </header>
                        <div class="slds-modal__content slds-p-around_medium">
                            <p><strong>Student Name:</strong> {selectedStudent.First_Name__c} {selectedStudent.Last_Name__c}</p>
                            <p><strong>Student Code:</strong> {selectedStudent.Student_Code__c}</p>
                            <p><strong>Class Name:</strong> {selectedStudent.Class__r.Class_Name__c}</p>
                            <button class="slds-button " title="Close" onclick={deleteStudentHandler} data-student-id={selectedStudent.Id}>Delete</button>
                            <button class="slds-button " title="Close" onclick={closeModalDelete} >Close</button>
                        </div>
                    </div>
                </div>
                <div class="slds-backdrop slds-backdrop_open"></div>
            </template>
             <!--UPDATE Modal Section -->
            <template if:true={isUpdateModalOpen}>
                <div class="slds-backdrop slds-backdrop_open"></div>
                <div class="slds-modal slds-fade-in-open">
                    <div class="slds-modal__container">
                        <div class="slds-modal__header">
                            <h2 class="slds-text-heading_medium">Modal Header</h2>
                        </div>
                        <div class="slds-modal__content slds-p-around_medium">
                            <!-- <c-lwc-update-student ></c-lwc-update-student> -->
                            <c-lwc-update-student student-id={selectedStudent.Id} student={selectedStudent} class-list={classes} gender-options={genderOptions}></c-lwc-update-student>
                            <button class="slds-button " title="Close" onclick={closeModalUpdate} >Close</button>
                        </div>
                    </div>
                </div>
            </template>
            <!--DETAIL Modal Section -->
            <template if:true={isDetailModalOpen}>
                <div class="slds-backdrop slds-backdrop_open"></div>
                <div class="slds-modal slds-fade-in-open">
                    <div class="slds-modal__container">
                        <div class="slds-modal__header">
                            <h2 class="slds-text-heading_medium">Modal Header</h2>
                        </div>
                        <div class="slds-modal__content slds-p-around_medium">
                            <!-- <c-lDetailupdate-student ></c-lDetailupdate-student> -->
                            <c-lwc-detail-student student={selectedStudent}  ></c-lwc-detail-student>
                            <button class="slds-button " title="Close" onclick={closeModalDetail} >Close</button>
                        </div>
                    </div>
                </div>
            </template>
            <template if:true={students}>
                <div class="slds-m-bottom_medium">
                    <lightning-button label="Delete Selected" onclick={deleteSelectedStudents} disabled={isDeleteSelectedStudentsDisabled}></lightning-button>
                </div>
                <table class="slds-table slds-table_bordered slds-table_cell-buffer">
                    <thead>
                        <tr>
                            <th scope="col">
                                <div class="slds-truncate" title="Select">
                                    <input type="checkbox"  checked={isSelectAllChecked} onchange={handleSelectAll} />
                                </div>
                            </th>    
                            <th scope="col">Student Code</th>
                            <th scope="col">First Name</th>
                            <th scope="col">Last Name</th>
                            <th scope="col">Class</th>
                            <th scope="col">Gender</th>
                            <th scope="col">Birthdate</th>
                            <th scope="col">Address</th>
                            <!-- Add more columns as needed -->
                            <th scope="col">
                                <div class="slds-truncate" title="Details">Details</div>
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <template for:each={displayedStudents} for:item="student">
                            <tr key={student.Student_Code__c}>
                                <td>
                                    <div class="slds-truncate" title="Select">
                                        <input type="checkbox" value={student.Student_Code__c} checked={student.selected__c} onchange={handleSelect} />
                                    </div>
                                </td>
                                <td>{student.Student_Code__c}</td>
                                <td>{student.First_Name__c}</td>
                                <td>{student.Last_Name__c}</td>
                                <td>{student.Class__r.Class_Name__c}</td>
                                <td>{student.Gender__c}</td>
                                <td>{student.Birthdate__c}</td>
                                <td>{student.Address__c}</td>
                                <!-- Add more columns as needed -->
                                <td>
                                    <lightning-button-icon
                                        icon-name="utility:description"
                                        alternative-text="Details"
                                        title="Details"
                                        onclick={openModalDetail} 
                                        data-student-id={student.Id}>
                                    </lightning-button-icon>
                                    <lightning-button-icon
                                        icon-name="utility:delete"
                                        alternative-text="Delete"
                                        title="Delete"
                                        onclick={openModalDelete}
                                        data-student-id={student.Id}>
                                    </lightning-button-icon>
                                    <lightning-button-icon
                                        icon-name="utility:settings"
                                        alternative-text="settings"
                                        title="Delete"
                                        onclick={openModalUpdate}
                                        data-student-id={student.Id}>
                                    </lightning-button-icon>
                                </td>
                            </tr>
                        </template>
                    </tbody>
                </table>

                <div class="slds-m-top_medium">
                    <lightning-layout>
                        <lightning-layout-item flexibility="auto" size="1">
                            <lightning-button-icon
                                icon-name="utility:chevronleft"
                                alternative-text="Previous"
                                onclick={previousPage}
                                disabled={isPreviousDisabled}>
                            </lightning-button-icon>
                        </lightning-layout-item>
                        <lightning-layout-item flexibility="auto" size="1">
                            Page {currentPage} of {totalPages}
                        </lightning-layout-item>
                        <lightning-layout-item flexibility="auto" size="1">
                            <lightning-button-icon
                                icon-name="utility:chevronright"
                                alternative-text="Next"
                                onclick={nextPage}
                                disabled={isNextDisabled}>
                            </lightning-button-icon>
                        </lightning-layout-item>
                    </lightning-layout>
                    <div class="slds-col  slds-m-top_small">
                        <p>Selected: {selectedStudentIds.length} of {displayedStudents.length} total Records</p>
                    </div>
                </div>
            </template>

            <template if:true={error}>
                <p>{error}</p>
            </template>
        </div>
    </lightning-card>
</template>
